<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.15">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Taylor Dunn">
<meta name="dcterms.date" content="2021-12-30">
<meta name="description" content="Creating an R package that wraps the Canadian COVID-19 tracker API.">

<title>tdunn - Canada COVID-19 data in R: creating a package</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../td.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-196523553-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>

<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<meta property="og:title" content="tdunn - Canada COVID-19 data in R: creating a package">
<meta property="og:description" content="Creating an R package that wraps the Canadian COVID-19 tracker API.">
<meta property="og:image" content="https://tdunn.ca/posts\2021-12-30-canada-covid-19-data-in-r-creating-a-package\preview.png">
<meta property="og:site-name" content="tdunn">
<meta property="og:image:height" content="1200">
<meta property="og:image:width" content="1800">
<meta name="twitter:title" content="tdunn - Canada COVID-19 data in R: creating a package">
<meta name="twitter:description" content="Creating an R package that wraps the Canadian COVID-19 tracker API.">
<meta name="twitter:image" content="https://tdunn.ca/posts\2021-12-30-canada-covid-19-data-in-r-creating-a-package\preview.png">
<meta name="twitter:creator" content="@TDunn12">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1200">
<meta name="twitter:image-width" content="1800">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">tdunn</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Posts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects/index.html">Projects</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/taylordunn"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/TDunn12"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/dunn-taylor/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Canada COVID-19 data in R: creating a package</h1>
                  <div>
        <div class="description">
          <p>Creating an R package that wraps the Canadian COVID-19 tracker API.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">COVID-19</div>
                <div class="quarto-category">API</div>
                <div class="quarto-category">package development</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Taylor Dunn <a href="https://orcid.org/0000-0001-8042-1611" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 30, 2021</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">TL;DR</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#naming" id="toc-naming" class="nav-link" data-scroll-target="#naming">Naming</a></li>
  <li><a href="#general-steps" id="toc-general-steps" class="nav-link" data-scroll-target="#general-steps">General steps</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#detour-refactoring-code-already" id="toc-detour-refactoring-code-already" class="nav-link" data-scroll-target="#detour-refactoring-code-already">Detour: refactoring code (already)</a></li>
  </ul></li>
  <li><a href="#reports" id="toc-reports" class="nav-link" data-scroll-target="#reports">Reports</a>
  <ul class="collapse">
  <li><a href="#detour-rate-limiting" id="toc-detour-rate-limiting" class="nav-link" data-scroll-target="#detour-rate-limiting">Detour: rate limiting</a></li>
  </ul></li>
  <li><a href="#vaccination-data" id="toc-vaccination-data" class="nav-link" data-scroll-target="#vaccination-data">Vaccination data</a>
  <ul class="collapse">
  <li><a href="#summary-and-reports" id="toc-summary-and-reports" class="nav-link" data-scroll-target="#summary-and-reports">Summary and reports</a></li>
  <li><a href="#sub-regions" id="toc-sub-regions" class="nav-link" data-scroll-target="#sub-regions">Sub-regions</a></li>
  </ul></li>
  <li><a href="#vaccine-age-groups" id="toc-vaccine-age-groups" class="nav-link" data-scroll-target="#vaccine-age-groups">Vaccine age groups</a></li>
  <li><a href="#regions-and-sub-regions" id="toc-regions-and-sub-regions" class="nav-link" data-scroll-target="#regions-and-sub-regions">Regions and sub-regions</a></li>
  <li><a href="#provinces" id="toc-provinces" class="nav-link" data-scroll-target="#provinces">Provinces</a></li>
  <li><a href="#an-example-use-case" id="toc-an-example-use-case" class="nav-link" data-scroll-target="#an-example-use-case">An example use case</a></li>
  <li><a href="#hex-sticker" id="toc-hex-sticker" class="nav-link" data-scroll-target="#hex-sticker">Hex sticker</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/taylordunn/tdunn-quarto/edit/main/posts/2021-12-30-canada-covid-19-data-in-r-creating-a-package/canada-covid-19-data-in-r-creating-a-package.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/taylordunn/tdunn-quarto/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">




<div class="cell">
<details>
<summary>R setup</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dunnr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>extrafont<span class="sc">::</span><span class="fu">loadfonts</span>(<span class="at">device =</span> <span class="st">"win"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_td</span>())</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set_geom_fonts</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set_palette</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TL;DR</h2>
<p>To see the finished product, check out the <a href="https://taylordunn.github.io/canadacovid/">package website</a> and the <a href="https://github.com/taylordunn/canadacovid">source code</a>. The package was published on CRAN recently, and can be downloaded with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"canadacovid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In <a href="../2021-12-28-canada-covid-19-data-in-r-exploring-the-api">my previous post</a>, I explored the <a href="https://api.covid19tracker.ca/">Canadian COVID-19 tracker API</a> and decided to make an API wrapper package to facilitate using it in R.</p>
</section>
<section id="naming" class="level2">
<h2 class="anchored" data-anchor-id="naming">Naming</h2>
<p>The first, and <a href="https://devguide.ropensci.org/building.html#package-name-and-metadata">some</a> <a href="https://r-pkgs.org/Workflow101.html#naming">would say</a> <a href="https://www.njtierney.com/post/2018/06/20/naming-things/">the hardest step</a> for writing a package (or any piece of code for that matter) is naming it. I considered a lot of options, and in the end decided on the admittedly boring <code>canadacovid</code>, which I verified was available:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>available<span class="sc">::</span><span class="fu">available</span>(<span class="st">"canadacovid"</span>, <span class="at">browse =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="images/available.PNG" class="img-fluid"></p>
</section>
<section id="general-steps" class="level2">
<h2 class="anchored" data-anchor-id="general-steps">General steps</h2>
<p>With the <code>usethis</code> and <code>devtools</code> packages, getting an R package started with best practices is very easy.</p>
<p>First, I create the package, set it up on GitHub, and write some minor documentation:</p>
<ol type="1">
<li><code>usethis::create_tidy_package("canadacovid")</code>: creates the RStudio project and opens it.</li>
<li>Connect GitHub.
<ul>
<li><code>usethis::use_git()</code> creates the local repo.</li>
<li><code>usethis::use_github()</code> creates the repo on GitHub and makes an initial commit and push.</li>
<li><code>usethis::use_tidy_github()</code> adds some files to follow <code>tidyverse</code> package conventions, e.g.&nbsp;a template <code>contributing.md</code>.</li>
<li><code>usethis::use_github_actions()</code> configures a basic <code>R CMD check</code> workflow on GitHub Actions.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
<li><code>usethis::use_tidy_github_actions()</code> sets up additional workflows for GitHub Actions.</li>
</ul></li>
<li>As a <code>tidyverse</code> enthusiast, I always setup my packages to use <code>magittr</code>’s pipe operator <code>%&gt;%</code> with <code>usethis::use_pipe</code>.</li>
<li><code>usethis::use_testthat()</code> sets up the <code>testthat</code> package and directory structure.
<ul>
<li>This step actually isn’t necessary, as it was already done by <code>create_tidy_package</code>.</li>
</ul></li>
<li>Update the <code>DESCRIPTION</code> file, particularly the <code>Title</code>, <code>Description</code> and <code>Authors</code> fields.</li>
<li>Run <code>devtools::document()</code> which will update the <code>NAMESPACE</code> file with the <code>magittr</code> pipe.</li>
</ol>
<p>Immediately after pushing these setup steps to GitHub, GitHub Actions got to work but failed on two of three workflows:</p>
<p><img src="images/github-actions-1.PNG" class="img-fluid"></p>
<p>Both the <code>R CMD</code> and the test coverage workflows failed because I haven’t written any tests yet (or functions to be tested for that matter). Which brings me to the main package development process:</p>
<ol type="1">
<li><code>usethis::use_r("file-name")</code> creates the <code>R/file-name.R</code> file.</li>
<li>Add one or more R functions to <code>file-name.R</code>.</li>
<li><code>usethis::use_package("dependency")</code> to declare any package dependencies, updating the <code>DESCRIPTION</code> file.</li>
<li>Document the function(s):
<ul>
<li>In RStudio, select <code>Code -&gt; Insert Roxygen Skeleton</code> (or Ctrl+Alt+Shift+R on Windows).</li>
<li>Run <code>devtools::document()</code> to generate the <code>.Rd</code> file and update <code>NAMESPACE</code>.</li>
<li>Optional: check the documentation with <code>?func-name</code>.</li>
<li>Optional: if using examples, check them with <code>devtools::check_examples()</code>.</li>
</ul></li>
<li>Try it out.
<ul>
<li><code>devtools::load_all()</code> to load all package functions (Ctrl+Shift+L on Windows).</li>
<li><code>devtools::check()</code> runs <code>R CMD check</code> on the package.</li>
</ul></li>
<li>Write tests with <code>testthat</code>.
<ul>
<li><code>use_test("file-name")</code> creates the <code>tests/testthat/test-file-name.R</code> file, paired to <code>R/file-name.R</code> file.</li>
<li><code>devtools::test()</code> or <code>usethis::test_package()</code> runs all tests.</li>
<li><code>devtools::test_active_file()</code> tests just the active file.</li>
</ul></li>
<li>Optional: update the <code>README.Rmd</code> with new functionality.
<ul>
<li><code>devtools::build_readme()</code> to knit.</li>
</ul></li>
<li>Optional: write or update a vignette to incorporate new functionality.
<ul>
<li><code>usethis::use_vignette("vignette-name")</code> to initialize the vignette file.</li>
<li><code>devtools::build_vignettes()</code> to knit the vignettes.</li>
</ul></li>
</ol>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>The first function I will add retrieves the latest summary data from the API. I’ll call this file <code>summary.R</code>, and create it (and it’s associated test file) with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">"summary"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">"summary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here is the <code>get_summary</code> function added to <code>R/summary.R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>get_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">split =</span> <span class="fu">c</span>(<span class="st">"overall"</span>, <span class="st">"province"</span>, <span class="st">"region"</span>)) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  split <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(split)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca/summary"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  split_path <span class="ot">&lt;-</span> <span class="cf">switch</span>(split,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">overall =</span> <span class="st">""</span>, <span class="at">province =</span> <span class="st">"/split"</span>, <span class="at">region =</span> <span class="st">"/split/hr"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, split_path)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(url)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">http_error</span>(resp)) {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"API requested failed with code"</span>, httr<span class="sc">::</span><span class="fu">status_code</span>(resp)),</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">http_type</span>(resp) <span class="sc">!=</span> <span class="st">"application/json"</span>) {</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"API did not return JSON"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  content_parsed <span class="ot">&lt;-</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(httr<span class="sc">::</span><span class="fu">content</span>(resp, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>),</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(content_parsed[<span class="st">"last_updated"</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"^change|total"</span>), as.integer),</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"date"</span>), as.Date),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">last_updated =</span> <span class="fu">as.POSIXct</span>(.data<span class="sc">$</span>last_updated)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Some notes:</p>
<ul>
<li>See <a href="../2021-12-28-canada-covid-19-data-in-r-exploring-the-api/#summary">my previous post</a> for a more thorough explanation of how this code is interacting with the API and processing the data.</li>
<li>For all of the imported functions, it is <a href="https://r-pkgs.org/dependencies.html#run-time-vs-develop-time-dependencies">good practice to explicitly state the package</a>, e.g.&nbsp;<code>httr::GET</code>.
<ul>
<li>The exception is the very last line where I use <code>rlang</code> to refer to the variable <code>.data$last_updated</code>. I find it clunky to include package names within pipe operations like that.</li>
</ul></li>
<li><code>match.arg</code> is a helpful base R function which matches the <code>split</code> parameter to just one of the given values. It returns an error if an unexpected value is provided.</li>
<li>I followed the advice from <a href="https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html">this <code>httr</code> vignette</a> and turned API errors into R errors.
<ul>
<li>The <code>httr::http_error</code> conditional returns an error message if the GET request failed, with the resulting HTTP status code.</li>
<li>The <code>httr::http_type</code> conditional returns an error message if the content is not in JSON format as expected.</li>
</ul></li>
<li>Instead of using the <code>as = "parsed"</code> argument to <code>httr::content</code>, I parse the raw text directly using <code>jsonlite::fromJSON</code>.
<ul>
<li>See <a href="https://httr.r-lib.org/reference/content.html#warning">this warning from the <code>httr</code> documentation</a> for the reason.</li>
</ul></li>
</ul>
<p>Add the dependencies:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"httr"</span>, <span class="at">type =</span> <span class="st">"Imports"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"jsonlite"</span>, <span class="at">type =</span> <span class="st">"Imports"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"dplyr"</span>, <span class="at">type =</span> <span class="st">"Imports"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"tidyselect"</span>, <span class="at">type =</span> <span class="st">"Imports"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"rlang"</span>, <span class="at">type =</span> <span class="st">"Imports"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I’ve explicitly set the <code>type</code> to “Imports” (which wasn’t necessary as this is the default) to make the point that it is <a href="https://r-pkgs.org/dependencies.html#sec-search-path">recommended over “Depends”</a>:</p>
<blockquote class="blockquote">
<p>Unless there is a good reason otherwise, you should always list packages in Imports not Depends. That’s because a good package is self-contained, and minimises changes to the global environment (including the search path).</p>
</blockquote>
<p>Next, some <a href="https://r-pkgs.org/man.html#roxygen2-basics">Roxygen documentation</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get the most recent summary data</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Runs a GET request of summary data from the COVID-19 tracker API, and</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' returns parsed data.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' Via the `split` argument, data my be "overall" (all provinces/territories</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' combined), by "province" (one row per province/territory) or by "region"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' (one row per health region).</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param split One of "overall", "province", or "region" to specify how the</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'   data is split.</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame containing the summary data.</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_summary()</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_summary("province")</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_summary("region")</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom httr GET http_error http_type content</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom jsonlite fromJSON</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr bind_rows bind_cols mutate across</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tidyselect matches</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom rlang .data</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>get_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">split =</span> <span class="fu">c</span>(<span class="st">"overall"</span>, <span class="st">"province"</span>, <span class="st">"region"</span>)) {</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now I’ll edit the <code>test-summary.R</code> file with some simple tests (and run it here as an example):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(testthat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-summary-test_d4ded40a5f38e8a7595e06de72f96cc9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_summary works"</span>, {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">get_summary</span>(<span class="at">split =</span> <span class="st">"provice"</span>), <span class="st">"arg"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  summary_overall <span class="ot">&lt;-</span> <span class="fu">get_summary</span>()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(summary_overall), <span class="dv">1</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(summary_overall), <span class="dv">24</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_false</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(summary_overall)))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  summary_province <span class="ot">&lt;-</span> <span class="fu">get_summary</span>(<span class="at">split =</span> <span class="st">"province"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(summary_province), <span class="dv">13</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(summary_province), <span class="dv">25</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_false</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(summary_province)))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(summary_province<span class="sc">$</span>province,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="st">"ON"</span>, <span class="st">"QC"</span>, <span class="st">"NS"</span>, <span class="st">"NB"</span>, <span class="st">"MB"</span>, <span class="st">"BC"</span>, <span class="st">"PE"</span>, <span class="st">"SK"</span>, <span class="st">"AB"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"NL"</span>, <span class="st">"NT"</span>, <span class="st">"YT"</span>, <span class="st">"NU"</span>))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  summary_region <span class="ot">&lt;-</span> <span class="fu">get_summary</span>(<span class="at">split =</span> <span class="st">"region"</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(summary_region), <span class="dv">92</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😸</code></pre>
</div>
</div>
<p>Everything passed successfully. Here is what was tested, from top to bottom:</p>
<ul>
<li>An error was returned for a misspelled <code>split</code> argument.</li>
<li><code>summary_overall</code> has the expected number of rows, columns and no values are <code>NA</code>.</li>
<li><code>summary_province</code> has the expected number of rows, columns and no values are <code>NA</code>. Also the expected 13 provinces/territories are returned.</li>
<li><code>summary_region</code> has the expected number of rows. The number of columns will vary, because columns with all missing (<code>NULL</code>) values will be dropped.</li>
</ul>
<p>Now with a documented and tested function, I do the following:</p>
<ul>
<li><code>devtools::check()</code> to run a <code>R CMD check</code> (also runs the <code>testthat</code> tests), which passes.</li>
<li>Update the <code>README.Rmd</code> with installation instructions, and an example of using <code>get_summary()</code>. Then build with <code>devtools::build_readme()</code>.</li>
</ul>
<p>I pushed this first iteration of the package to GitHub and, after about 10 minutes, all of the GitHub Actions workflows were successful:</p>
<p><img src="images/github-actions-2.PNG" class="img-fluid"></p>
<section id="detour-refactoring-code-already" class="level3">
<h3 class="anchored" data-anchor-id="detour-refactoring-code-already">Detour: refactoring code (already)</h3>
<p>Before continuing with other functions, it occurred to me that I would end up re-writing this particular block of code multiple times:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(url)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">http_error</span>(resp)) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"API requested failed with code"</span>, httr<span class="sc">::</span><span class="fu">status_code</span>(resp)),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">http_type</span>(resp) <span class="sc">!=</span> <span class="st">"application/json"</span>) {</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"API did not return JSON"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>content_parsed <span class="ot">&lt;-</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(httr<span class="sc">::</span><span class="fu">content</span>(resp, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A quote from <a href="https://r4ds.had.co.nz/functions.html?q=function#when-should-you-write-a-function">R for Data Science</a>:</p>
<blockquote class="blockquote">
<p>You should consider writing a function whenever you’ve copied and pasted a block of code more than twice (i.e.&nbsp;you now have three copies of the same code).</p>
</blockquote>
<p>So instead of copying and pasting this code block, I made a new function in a new file, <code>api.R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">"api"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">"api"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get content and parse it</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Sends a GET request to https://api.covid19tracker.ca/.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' If the request is successful and the returned content is JSON, formats it and</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' returns it parsed (via `jsonlite::fromJSON`).</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param url A string URL linking to the API. If it does not contain the base</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'   "https://api.covid19tracker.ca", then `url` will be combined with the base</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'   to attempt to make a valid URL (and return a warning).</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A list.</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_content_parsed("https://api.covid19tracker.ca/provinces")</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom httr GET http_error http_type content</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom jsonlite fromJSON</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom stringr str_detect</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>get_content_parsed <span class="ot">&lt;-</span> <span class="cf">function</span>(url) {</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca"</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(url, base_url)) {</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"/"</span>, url)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Provided URL did not include base ("</span>, base_url, <span class="st">").</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Combined URL with base for GET request: "</span>, url)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>  resp <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(url)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">http_error</span>(resp)) {</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"API requested failed with code"</span>, httr<span class="sc">::</span><span class="fu">status_code</span>(resp)),</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">http_type</span>(resp) <span class="sc">!=</span> <span class="st">"application/json"</span>) {</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"API did not return JSON"</span>, <span class="at">call. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>  jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(httr<span class="sc">::</span><span class="fu">content</span>(resp, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>),</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">simplifyVector =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This function expects a full <code>url</code>, but will add “https://api.covid19tracker.ca” if it is missing (and return a warning to say so). Some simple tests for <code>get_content_parsed</code>:</p>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-content-parsed-test_6941f9ba4fed14c523bac5f00677926d">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_content_parsed works"</span>, {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_warning</span>(<span class="fu">get_content_parsed</span>(<span class="st">"provinces"</span>), <span class="st">"base"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_content_parsed</span>(<span class="st">"https://api.covid19tracker.ca/provices"</span>), <span class="st">"API"</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  provinces <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(<span class="st">"https://api.covid19tracker.ca/provinces"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">is.list</span>(provinces))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">lengths</span>(provinces), <span class="fu">rep</span>(<span class="dv">12</span>, <span class="dv">16</span>))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😀</code></pre>
</div>
</div>
<p>Everything checks out, so I replace some of the code in <code>get_summary</code> with a call to <code>get_content_parsed</code>.</p>
<p>I don’t need to re-write tests for <code>get_summary</code> because it is functionally the same, but I <em>do re-run those tests</em> to make sure I didn’t break it with these changes (this is the whole point of unit testing). I then run <code>devtools::check()</code> and push changes to GitHub.</p>
</section>
</section>
<section id="reports" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="reports">Reports</h2>
<p>Writing the function to get reports follows the same procedure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">"reports"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">"reports"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The reports are a bit more complicated because the queries can <a href="../2021-12-28-canada-covid-19-data-in-r-exploring-the-api/#parameters">accept a few different parameters</a>. Here is my first draft of <code>get_reports</code>, along with Roxygen documentation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get the day-to-day reports</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Runs a GET request of reports data from the COVID-19 tracker API, and</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' returns parsed data.</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' Via the `split` argument, data may be "overall" (all provinces/territories</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' combined), or by "province".</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' Alternatively, provide one or more two-letter codes (e.g. "AB") to `province`</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' to return reports for specific provinces, or one or more numeric `region`</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' codes (e.g. "1204") to return specific health regions.</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param split One of "overall", or "province" to specify how the</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#'   data is split. An "overall" report gives cumulative numbers across Canada.</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Splitting by "province" returns all reports for all provinces/territories.</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param province One or more province/territory codes ("AB", "BC", "MB", "NB",</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#'   "NL", "NS", "NT", "NU", "ON", "PE", "QC", "SK", "YT") to get reports.</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Upper, lower and mixed case strings are accepted.</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param region One or more health region IDs to get reports. Numeric and</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">#'   character values are accepted.</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param fill_dates When TRUE, the response fills in any missing dates with</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">#'   blank entries.</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param stat Returns only the specified statistics, e.g. "cases".</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param date Returns reports from only the specified date.</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param after Returns reports from only on or after the specified date.</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param before Returns reports from only on or before the specified date.</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame containing the reports data, one row per day. Includes</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#'   a `province` variable if data is split by province, and a `hr_uid` variable</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co">#'   if data is split by health region.</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_reports()</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_reports("province")</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_reports(province = c("AB", "SK"))</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_reports(region = 1204)</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_reports(region = c("472", 1204), stat = "cases")</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr bind_rows bind_cols mutate across</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tidyselect matches</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom rlang .data</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom purrr imap_chr map_dfr</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tibble lst</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>get_reports <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">split =</span> <span class="fu">c</span>(<span class="st">"overall"</span>, <span class="st">"province"</span>),</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>                        <span class="at">province =</span> <span class="cn">NULL</span>, <span class="at">region =</span> <span class="cn">NULL</span>,</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill_dates =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="cn">NULL</span>, <span class="at">date =</span> <span class="cn">NULL</span>,</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>                        <span class="at">after =</span> <span class="cn">NULL</span>, <span class="at">before =</span> <span class="cn">NULL</span>) {</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca/reports/"</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>  province_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AB"</span>, <span class="st">"BC"</span>, <span class="st">"MB"</span>, <span class="st">"NB"</span>, <span class="st">"NL"</span>, <span class="st">"NS"</span>, <span class="st">"NT"</span>, <span class="st">"NU"</span>, <span class="st">"ON"</span>,</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PE"</span>, <span class="st">"QC"</span>, <span class="st">"SK"</span>, <span class="st">"YT"</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>  split <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(split)</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (split <span class="sc">==</span> <span class="st">"province"</span>) province <span class="ot">&lt;-</span> province_codes</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>  parameters <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">lst</span>(fill_dates, stat, date, after, before)</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove NULL parameters</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>  parameters <span class="ot">&lt;-</span> parameters[<span class="fu">lengths</span>(parameters) <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(parameters) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    params_url <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">imap_chr</span>(parameters, <span class="sc">~</span> <span class="fu">paste0</span>(.y, <span class="st">"="</span>, <span class="fu">tolower</span>(.x))) <span class="sc">%&gt;%</span></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"&amp;"</span>)</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    params_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"?"</span>, params_url)</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    params_url <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(province)) {</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    province <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(<span class="fu">toupper</span>(province), province_codes, <span class="at">several.ok =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    reports <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>      province,</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(province) {</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>        url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"province/"</span>, province, params_url)</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>        content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>          content_parsed[<span class="fu">c</span>(<span class="st">"province"</span>, <span class="st">"last_updated"</span>)],</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(region)) {</span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>    reports <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a>      region,</span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(region) {</span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>        url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"regions/"</span>, region, params_url)</span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>        content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>          content_parsed[<span class="fu">c</span>(<span class="st">"hr_uid"</span>, <span class="st">"last_updated"</span>)],</span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>    content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(<span class="fu">paste0</span>(base_url, params_url))</span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>    reports <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a>      content_parsed[<span class="st">"last_updated"</span>],</span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a>  reports <span class="sc">%&gt;%</span></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"^change|total"</span>), as.integer),</span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"date"</span>), as.Date),</span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">last_updated =</span> <span class="fu">as.POSIXct</span>(.data<span class="sc">$</span>last_updated)</span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside>
<p>And the new dependencies:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"tibble"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"purrr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</aside>
<p>The <code>get_content_parsed</code> function paid off already – I used it three times above, saving ~20 lines of code each time.</p>
<p>Note that I didn’t allow <code>split = "region"</code> as an option because, if the function queries all regions, 92 separate <code>GET</code> requests are sent to the API in a short period. This eventually fails with HTTP code 429, indicating too many requests. This is called “rate limiting”, and the error code is a polite way of asking someone to stop spamming requests. I might alter this function in the future to send these requests slower, either with a call to <code>Sys.sleep()</code> or with the <a href="https://github.com/dmi3kno/polite"><code>polite</code> package</a>.</p>
<p><code>get_reports</code> is a more complex function than <code>get_summary</code>, and so I wrote more tests to try to capture that complexity:</p>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-reports-test_9fdee4bab1ea0bfe273af8f1f7d45c91">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_reports works"</span>, {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  reports_overall <span class="ot">&lt;-</span> <span class="fu">get_reports</span>()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(reports_overall), <span class="dv">24</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_false</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(reports_overall)))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  reports_province <span class="ot">&lt;-</span> <span class="fu">get_reports</span>(<span class="at">split =</span> <span class="st">"province"</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(reports_province<span class="sc">$</span>province), <span class="dv">13</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(reports_province<span class="sc">$</span>date), <span class="fu">min</span>(reports_overall<span class="sc">$</span>date))</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(reports_province<span class="sc">$</span>date), <span class="fu">max</span>(reports_overall<span class="sc">$</span>date))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  reports_ns_nb_nv <span class="ot">&lt;-</span> <span class="fu">get_reports</span>(<span class="at">province =</span> <span class="fu">c</span>(<span class="st">"NS"</span>, <span class="st">"nb"</span>, <span class="st">"nU"</span>, <span class="st">"test"</span>))</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(reports_ns_nb_nv<span class="sc">$</span>province), <span class="fu">c</span>(<span class="st">"NS"</span>, <span class="st">"NB"</span>, <span class="st">"NU"</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    reports_province <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(province <span class="sc">==</span> <span class="st">"NS"</span>),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    reports_ns_nb_nv <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(province <span class="sc">==</span> <span class="st">"NS"</span>)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">get_reports</span>(<span class="at">split =</span> <span class="st">"region"</span>), <span class="st">"arg"</span>)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  reports_592_2407_3561 <span class="ot">&lt;-</span> <span class="fu">get_reports</span>(<span class="at">region =</span> <span class="fu">c</span>(<span class="dv">592</span>, <span class="st">"2407"</span>, <span class="dv">3561</span>))</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unique</span>(reports_592_2407_3561<span class="sc">$</span>hr_uid),</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">592</span>, <span class="dv">2407</span>, <span class="dv">3561</span>)</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  reports_criticals <span class="ot">&lt;-</span> <span class="fu">get_reports</span>(<span class="at">split =</span> <span class="st">"province"</span>, <span class="at">stat =</span> <span class="st">"criticals"</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(reports_criticals), <span class="dv">5</span>)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(<span class="fu">names</span>(reports_criticals),</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="st">"province"</span>, <span class="st">"last_updated"</span>, <span class="st">"date"</span>,</span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"change_criticals"</span>, <span class="st">"total_criticals"</span>))</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  report_2021_07_20 <span class="ot">&lt;-</span> <span class="fu">get_reports</span>(<span class="at">province =</span> <span class="st">"MB"</span>, <span class="at">date =</span> <span class="st">"2021-07-20"</span>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(report_2021_07_20<span class="sc">$</span>date, <span class="fu">as.Date</span>(<span class="st">"2021-07-20"</span>))</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(report_2021_07_20<span class="sc">$</span>province, <span class="st">"MB"</span>)</span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  report_date_range <span class="ot">&lt;-</span> <span class="fu">get_reports</span>(<span class="at">region =</span> <span class="dv">3570</span>,</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">after =</span> <span class="st">"2021-10-28"</span>, <span class="at">before =</span> <span class="st">"2021-11-02"</span>)</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">min</span>(report_date_range<span class="sc">$</span>date), <span class="fu">as.Date</span>(<span class="st">"2021-10-28"</span>))</span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">max</span>(report_date_range<span class="sc">$</span>date), <span class="fu">as.Date</span>(<span class="st">"2021-11-02"</span>))</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥳</code></pre>
</div>
</div>
<section id="detour-rate-limiting" class="level3">
<h3 class="anchored" data-anchor-id="detour-rate-limiting">Detour: rate limiting</h3>
<p>Pushing the <code>reports</code> file and tests to GitHub resulted in failed <code>R CMD check</code>s due to API errors with the HTTP code 429. This is because all my <code>testthat</code> tests were running on 9 different platforms and flooding the API with too many requests.</p>
<p>There are more sophisticated ways to limit the request rate (e.g.&nbsp;using the <a href="https://httr2.r-lib.org/">re-written <code>httr2</code> package</a>, the <a href="https://github.com/vcr/vcr"><code>vcr</code> package</a>, the <a href="https://github.com/nealrichardson/httptest"><code>httptest</code> package</a>) but I decided to use the humble <code>Sys.sleep()</code>. To control the delay time across all tests, I added a <a href="https://testthat.r-lib.org/articles/test-fixtures.html#package">setup file</a> at <code>tests/testthat/setup.R</code> with a very simple function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>request_sleep <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">seconds =</span> <span class="dv">10</span>) {</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(seconds)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I then called this function before every <code>GET</code> request in my tests so that there was at least a 10 second delay between each (I initially tried 5 seconds, but it was still too fast).</p>
</section>
</section>
<section id="vaccination-data" class="level2">
<h2 class="anchored" data-anchor-id="vaccination-data">Vaccination data</h2>
<p>The vaccination data is organized a bit differently – see the <a href="https://api.covid19tracker.ca/docs/1.0/vaccinations">API documentation</a> or <a href="../2021-12-28-canada-covid-19-data-in-r-exploring-the-api/#vaccination-data">my exploration of it</a>.</p>
<section id="summary-and-reports" class="level3">
<h3 class="anchored" data-anchor-id="summary-and-reports">Summary and reports</h3>
<p>The summary and reports vaccination data is simply the same summary and reports from before, but with only the statistics related to vaccination: <code>vaccinations</code>, <code>vaccinated</code>, <code>boosters_1</code>, and <code>vaccines_distributed</code>. This function simply wraps my previous <code>get_summary()</code> and <code>get_reports()</code> functions, and returns the relevant variables:</p>
<div class="cell">
<details>
<summary><code>get_vaccination_data()</code> documentation</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get vaccination data</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Runs a GET request of vaccination data from the COVID-19 tracker API, and</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' returns parsed data.</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' Data may be returned as `type` = "summary" (the most recent data) or</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' `type` = "reports" (day-to-day reports).</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' Via the `split` argument, data may be "overall" (all provinces/territories</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' combined), by "province", or by "region".</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' Alternatively, provide one or more two-letter codes (e.g. "AB") to `province`</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' to return reports for specific provinces, or one or more numeric `region`</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' codes (e.g. "1204") to return specific health regions.</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param type One of "summary" (most recent data) or "reports" (day-to-day</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#'   data).</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param split One of "overall", "province", or "region" to specify how the</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#'   data is split. An "overall" summary or report gives cumulative numbers</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#'   across Canada. Splitting by "province" returns data for all</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#'   provinces/territories. Splitting by "region" is only available for</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">#'   "summary" data, and returns data for all health regions.</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param province One or more province/territory codes ("AB", "BC", "MB", "NB",</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">#'   "NL", "NS", "NT", "NU", "ON", "PE", "QC", "SK", "YT") to get reports.</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Upper, lower and mixed case strings are accepted.</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param region One or more health region IDs to get reports. Numeric and</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">#'   character values are accepted.</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param fill_dates When TRUE, the response fills in any missing dates with</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co">#'   blank entries.</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param stat Returns only the specified statistics, e.g. "cases".</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param date Returns reports from only the specified date.</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param after Returns reports from only on or after the specified date.</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param before Returns reports from only on or before the specified date.</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame containing the vaccinations data. Includes</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="co">#'   a `province` variable if data is split by province, and a `hr_uid` variable</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="co">#'   if data is split by health region.</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccination_data()</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccination_data(split = "province")</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccination_data(type = "reports", split = "overall")</span></span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccination_data(type = "reports", split = "overall",</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a><span class="co">#'                      date = "2021-12-25")</span></span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr select</span></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tidyselect matches</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>get_vaccination_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">type =</span> <span class="fu">c</span>(<span class="st">"summary"</span>, <span class="st">"reports"</span>),</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">split =</span> <span class="fu">c</span>(<span class="st">"overall"</span>, <span class="st">"province"</span>, <span class="st">"region"</span>),</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">province =</span> <span class="cn">NULL</span>, <span class="at">region =</span> <span class="cn">NULL</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">fill_dates =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="cn">NULL</span>, <span class="at">date =</span> <span class="cn">NULL</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">after =</span> <span class="cn">NULL</span>, <span class="at">before =</span> <span class="cn">NULL</span>) {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(type)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  split <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(split)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (type <span class="sc">==</span> <span class="st">"summary"</span>) {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    vaccination_data <span class="ot">&lt;-</span> <span class="fu">get_summary</span>(split)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Getting reports for each region sends too many requests to the API</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (split <span class="sc">==</span> <span class="st">"region"</span>) {</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">paste</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">"For `type` = 'reports', only "</span>,</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">"`split` = 'overall' and 'province' are available."</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    vaccination_data <span class="ot">&lt;-</span> <span class="fu">get_reports</span>(</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>      split, province, region, fill_dates, stat,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>      date, after, before</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  vaccination_data <span class="sc">%&gt;%</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"province|hr_uid"</span>),</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"date|last_updated"</span>),</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>      tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"vacc|boost"</span>)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because this function can return both summaries and reports, I have to put in a <code>stop()</code> condition if reports by health region is requested, as this is not allowed by the API.</p>
<p>The tests for <code>get_vaccination_data</code> make use of the new <code>request_sleep</code> function:</p>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-vaccination-data-test_efa9f7d8f441e9cfcfe812fa6e0682ea">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_vaccination_data works"</span>, {</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  vaccination_data_summary <span class="ot">&lt;-</span> <span class="fu">get_vaccination_data</span>()</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(vaccination_data_summary), <span class="dv">1</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(vaccination_data_summary), <span class="dv">12</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  vaccination_data_report <span class="ot">&lt;-</span> <span class="fu">get_vaccination_data</span>(<span class="at">type =</span> <span class="st">"reports"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(vaccination_data_report), <span class="dv">12</span>)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_false</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(vaccination_data_report)))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  vaccination_data_summary_region <span class="ot">&lt;-</span> <span class="fu">get_vaccination_data</span>(<span class="at">split =</span> <span class="st">"region"</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(vaccination_data_summary_region), <span class="dv">92</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">get_vaccination_data</span>(<span class="at">type =</span> <span class="st">"reports"</span>, <span class="at">split =</span> <span class="st">"region"</span>))</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  vaccination_data_ns_pe <span class="ot">&lt;-</span> <span class="fu">get_vaccination_data</span>(<span class="at">type =</span> <span class="st">"reports"</span>,</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">province =</span> <span class="fu">c</span>(<span class="st">"NS"</span>, <span class="st">"pe"</span>))</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">unique</span>(vaccination_data_ns_pe<span class="sc">$</span>province), <span class="fu">c</span>(<span class="st">"NS"</span>, <span class="st">"PE"</span>))</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(vaccination_data_ns_pe),</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>               <span class="fu">nrow</span>(<span class="fu">get_reports</span>(<span class="at">province =</span> <span class="fu">c</span>(<span class="st">"NS"</span>, <span class="st">"pe"</span>))))</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😀</code></pre>
</div>
</div>
</section>
<section id="sub-regions" class="level3">
<h3 class="anchored" data-anchor-id="sub-regions">Sub-regions</h3>
<p>In some provinces/territories, there is additional vaccination data at the sub-region level, which requires unique requests from the API:</p>
<div class="cell">
<details>
<summary><code>get_subregion_vaccination_data()</code> documentation</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get sub-region vaccination data</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Runs a GET request of sub-region vaccination data from the COVID-19 tracker</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' API, and returns parsed data.</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' The `dates` argument specifies the time frame of the data: "current"</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' (the default; latest report for each sub-region), "recent"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' (15 most recent reports for each sub-region), and "all" (returns all reports</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' for one or more sub-regions specified by the `subregion_code` argument).</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' To get a list of available sub-regions, use the function `get_subregions()`.</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' Note that sub-region vaccination data is only for select provinces and</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' territories. Also the percentages reported differ between percent of total</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' population, and percent of eligible population.</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' See the API documentation for more details:</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' https://api.covid19tracker.ca/docs/1.0/vaccinations.</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param dates One of "current", "recent", or "all" to specify the time frame</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">#'   of the reports returned. If choosing "all" reports, must also provide one</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co">#'   or more sub-region codes.</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param subregion_code One or more sub-region codes. Returns all reports for</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">#'   those sub-regions (even if `dates` is not "all")</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame with one row per sub-region report.</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_subregion_vaccination_data()</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_subregion_vaccination_data("recent")</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_subregion_vaccination_data("all", subregion_code = c("ON382", "SK007"))</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr bind_cols bind_rows mutate</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom purrr map_dfr</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tidyselect matches</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>get_subregion_vaccination_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dates =</span> <span class="fu">c</span>(<span class="st">"current"</span>, <span class="st">"recent"</span>, <span class="st">"all"</span>),</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">subregion_code =</span> <span class="cn">NULL</span>) {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(dates)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca/reports/sub-regions/"</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  dates_path <span class="ot">&lt;-</span> <span class="cf">switch</span>(dates,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">current =</span> <span class="st">"summary"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">recent =</span> <span class="st">"recent"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">all =</span> <span class="st">""</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, dates_path)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(subregion_code)) {</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (dates <span class="sc">==</span> <span class="st">"all"</span>) {</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Must specify sub-region(s) to return all vaccination reports."</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    vaccination_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>      content_parsed[<span class="st">"last_updated"</span>],</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    vaccination_data <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>      subregion_code,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(subregion_code) {</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(url, subregion_code)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>          content_parsed[<span class="st">"sub_region"</span>],</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  vaccination_data <span class="sc">%&gt;%</span></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"^total"</span>), as.integer),</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"^percent"</span>), as.numeric),</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"date"</span>), as.Date),</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"last_updated"</span>), as.POSIXct)</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another <code>stop</code> condition prevents sending too many requests: this time when all subregion data is requested.</p>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-subregion-vaccination-data-test_22a15a9edbe22cd06cf4fb3e80c7c26b">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_subregion_vaccination_data works"</span>, {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  subregion_vaccination_data_current <span class="ot">&lt;-</span> <span class="fu">get_subregion_vaccination_data</span>()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(subregion_vaccination_data_current), <span class="dv">806</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(subregion_vaccination_data_current), <span class="dv">12</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  subregion_vaccination_data_recent <span class="ot">&lt;-</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_subregion_vaccination_data</span>(<span class="at">dates =</span> <span class="st">"recent"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">nrow</span>(subregion_vaccination_data_recent) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🌈</code></pre>
</div>
</div>
</section>
</section>
<section id="vaccine-age-groups" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="vaccine-age-groups">Vaccine age groups</h2>
<p>These data are week-by-week vaccination statistics for various age groups. The request URL is <code>/vaccines/age-groups</code> and takes a few parameters:</p>
<div class="cell">
<details>
<summary><code>get_vaccine_age_groups()</code> documentation</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get vaccination reports by age group</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Runs a GET request of vaccination data by age groups from the COVID-19</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' tracker API, and returns parsed data.</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' Via the `split` argument, data may be "overall" (all provinces/territories</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' combined), or by "province".</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' Alternatively, provide one or more two-letter codes (e.g. "AB") to `province`</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' to return reports for specific provinces.</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param split One of "overall", or "province" to specify how the</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">#'   data is split. An "overall" report gives cumulative numbers across Canada.</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Splitting by "province" returns all reports for all provinces/territories.</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param province One or more province/territory codes ("AB", "BC", "MB", "NB",</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">#'   "NL", "NS", "NT", "NU", "ON", "PE", "QC", "SK", "YT") to get reports.</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Upper, lower and mixed case strings are accepted.</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param group A specific age group to return, for example: "0-4", "05-11",</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">#'   "30-39", "80+", "not_reported"</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param after Returns reports from only on or after the specified date,</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">#'   in YYYY-MM-DD format.</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param before Returns reports from only on or before the specified date,</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">#'   in YYYY-MM-DD format.</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame with, one row per age group per date. Includes</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co">#'   a `province` variable if data is split by province.</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccine_age_groups()</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccine_age_groups(split = "province")</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccine_age_groups(province = c("AB", "SK"))</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccine_age_groups(province = "NS", group = "18-29")</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_vaccine_age_groups(group = "80+", after = "2021-12-01")</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr bind_rows bind_cols mutate across</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tidyselect matches</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom rlang .data</span></span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom purrr imap_chr map_dfr discard</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tibble lst</span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom jsonlite fromJSON</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom tidyr unnest</span></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom utils URLencode</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>get_vaccine_age_groups <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">split =</span> <span class="fu">c</span>(<span class="st">"overall"</span>, <span class="st">"province"</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">province =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">group =</span> <span class="cn">NULL</span>, <span class="at">before =</span> <span class="cn">NULL</span>, <span class="at">after =</span> <span class="cn">NULL</span>) {</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca/vaccines/age-groups"</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  province_codes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AB"</span>, <span class="st">"BC"</span>, <span class="st">"MB"</span>, <span class="st">"NB"</span>, <span class="st">"NL"</span>, <span class="st">"NS"</span>, <span class="st">"NT"</span>, <span class="st">"NU"</span>, <span class="st">"ON"</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PE"</span>, <span class="st">"QC"</span>, <span class="st">"SK"</span>, <span class="st">"YT"</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  split <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(split)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (split <span class="sc">==</span> <span class="st">"province"</span>) {</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    base_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"/split"</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(province)) {</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    province <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(<span class="fu">toupper</span>(province), province_codes, <span class="at">several.ok =</span> <span class="cn">TRUE</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    base_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"/province/"</span>, province)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  parameters <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">lst</span>(group, before, after)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove NULL parameters</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  parameters <span class="ot">&lt;-</span> parameters[<span class="fu">lengths</span>(parameters) <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(parameters) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    params_url <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">imap_chr</span>(</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>      parameters,</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">paste0</span>(.y, <span class="st">"="</span>, utils<span class="sc">::</span><span class="fu">URLencode</span>(.x, <span class="at">reserved =</span> <span class="cn">TRUE</span>))</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"&amp;"</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    params_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"?"</span>, params_url)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    params_url <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    base_url,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(base_url) {</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>      url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, params_url)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>      content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Because age ranges can change over time, some data returned is NULL</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>      <span class="co">#  if the `group` param is used</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(group)) {</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># So discard NULL elements</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>        content_parsed<span class="sc">$</span>data <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">discard</span>(content_parsed<span class="sc">$</span>data,</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>                                              <span class="sc">~</span> <span class="fu">is.null</span>(.x<span class="sc">$</span>data))</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(province)) {</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>          content_parsed[<span class="st">"province"</span>],</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>        .data<span class="sc">$</span>data,</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span>jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(.x) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"group_code"</span>)</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">unnest</span>(.data<span class="sc">$</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(tidyselect<span class="sc">::</span><span class="fu">matches</span>(<span class="st">"date"</span>), as.Date))</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside>
<p>And the new dependencies:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>(<span class="st">"utils"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</aside>
<p>There were some tricky aspects to this function, like how the content is JSON within JSON and the URL encoding for the age group parameter (see my <a href="../2021-12-28-canada-covid-19-data-in-r-exploring-the-api/#vaccine-age-groups">previous post</a>). Run some tests:</p>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-vaccine-age-groups-test_9430b61cb04daed37147eb91bd71e514">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_vaccine_age_groups works"</span>, {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  vacc_age_overall <span class="ot">&lt;-</span> <span class="fu">get_vaccine_age_groups</span>()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(vacc_age_overall<span class="sc">$</span>group), <span class="dv">19</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  vacc_age_province <span class="ot">&lt;-</span> <span class="fu">get_vaccine_age_groups</span>(<span class="at">split =</span> <span class="st">"province"</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(vacc_age_province<span class="sc">$</span>province), <span class="dv">13</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  vacc_age_mb_nt <span class="ot">&lt;-</span> <span class="fu">get_vaccine_age_groups</span>(<span class="at">province =</span> <span class="fu">c</span>(<span class="st">"test"</span>, <span class="st">"mB"</span>, <span class="st">"NT"</span>))</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(<span class="fu">unique</span>(vacc_age_mb_nt<span class="sc">$</span>province), <span class="fu">c</span>(<span class="st">"MB"</span>, <span class="st">"NT"</span>))</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  vacc_age_ns_18_29 <span class="ot">&lt;-</span> <span class="fu">get_vaccine_age_groups</span>(<span class="at">province =</span> <span class="st">"NS"</span>, <span class="at">group =</span> <span class="st">"18-29"</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(<span class="fu">unique</span>(vacc_age_ns_18_29<span class="sc">$</span>province), <span class="fu">c</span>(<span class="st">"NS"</span>))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(<span class="fu">unique</span>(vacc_age_ns_18_29<span class="sc">$</span>group), <span class="fu">c</span>(<span class="st">"18-29"</span>))</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  vacc_age_80p_date_range <span class="ot">&lt;-</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_vaccine_age_groups</span>(<span class="at">group =</span> <span class="st">"80+"</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>                           <span class="at">after =</span> <span class="st">"2021-03-20"</span>, <span class="at">before =</span> <span class="st">"2021-05-10"</span>)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">unique</span>(vacc_age_80p_date_range<span class="sc">$</span>group), <span class="st">"80+"</span>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">min</span>(vacc_age_80p_date_range<span class="sc">$</span>date) <span class="sc">&gt;=</span> <span class="st">"2021-03-20"</span>)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="fu">max</span>(vacc_age_80p_date_range<span class="sc">$</span>date) <span class="sc">&lt;=</span> <span class="st">"2021-05-10"</span>)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  vacc_age_not_reported <span class="ot">&lt;-</span> <span class="fu">get_vaccine_age_groups</span>(<span class="at">group =</span> <span class="st">"not_reported"</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">unique</span>(vacc_age_not_reported<span class="sc">$</span>group), <span class="st">"Not reported"</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_error</span>(<span class="fu">get_vaccine_age_groups</span>(<span class="at">group =</span> <span class="st">"90+"</span>))</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥳</code></pre>
</div>
</div>
</section>
<section id="regions-and-sub-regions" class="level2">
<h2 class="anchored" data-anchor-id="regions-and-sub-regions">Regions and sub-regions</h2>
<p>Health regions from <code>get_summary</code> and <code>get_reports</code> are specified by the non-descript <code>hr_uid</code> variable only. Also, the sub-regions from <code>get_subregion_vaccination_data</code> are specified by <code>code</code> only. Naturally, the API provides lists of regions and sub-regions, which I wrap with two new functions in the <code>regions.R</code> file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">"regions"</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_test</span>(<span class="st">"regions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get health regions</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Returns a list of health regions in the COVID-19 tracker.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' By default (`hr_uid` and `province` `NULL`), returns all 92 regions.</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param hr_uid One or more health region UIDs (e.g. 3553) to return.</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param province One or more provinces to return.</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame with a row per health region.</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_regions()</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_regions(hr_uid = c("2414", 591))</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_regions(province = c("ns", "SK"))</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr bind_rows</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom purrr map_dfr</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>get_regions <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">hr_uid =</span> <span class="cn">NULL</span>, <span class="at">province =</span> <span class="cn">NULL</span>) {</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca/"</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(hr_uid)) {</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"regions/"</span>, hr_uid)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(province)) {</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"province/"</span>, province, <span class="st">"/regions"</span>)</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"regions"</span>)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>    url,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(url) {</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>      content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(province)) {</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed)</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get sub-regions</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="co">#' Returns a list of sub-regions in the COVID-19 tracker.</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a><span class="co">#' By default, returns all 805 sub-regions.</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param subregion_code One or more sub-regions to be returned.</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame with a row per sub-region.</span></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_subregions()</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_subregions("AB001")</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_subregions(c("SK003", "SK005"))</span></span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr bind_rows</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom purrr map_dfr</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>get_subregions <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">subregion_code =</span> <span class="cn">NULL</span>) {</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca/sub-regions"</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(subregion_code)) {</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> base_url</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, <span class="st">"/"</span>, subregion_code)</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(</span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>    url,</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(url) {</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a>      content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed<span class="sc">$</span>data)</span>
<span id="cb36-73"><a href="#cb36-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-74"><a href="#cb36-74" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-75"><a href="#cb36-75" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Not very complicated, and neither are the corresponding tests:</p>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-regions-test_d1d00bcc288ff17a442ded5b54d9c69d">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_regions works"</span>, {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  regions <span class="ot">&lt;-</span> <span class="fu">get_regions</span>()</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_true</span>(<span class="st">"hr_uid"</span> <span class="sc">%in%</span> <span class="fu">names</span>(regions))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(regions), <span class="dv">92</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(regions<span class="sc">$</span>province), <span class="dv">13</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  regions_2418_3534 <span class="ot">&lt;-</span> <span class="fu">get_regions</span>(<span class="at">hr_uid =</span> <span class="fu">c</span>(<span class="dv">2418</span>, <span class="st">"3534"</span>))</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(regions_2418_3534<span class="sc">$</span>hr_uid, <span class="fu">c</span>(<span class="dv">2418</span>, <span class="dv">3534</span>))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  regions_mb_bc <span class="ot">&lt;-</span> <span class="fu">get_regions</span>(<span class="at">province =</span> <span class="fu">c</span>(<span class="st">"mb"</span>, <span class="st">"bC"</span>))</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">unique</span>(regions_mb_bc<span class="sc">$</span>province), <span class="fu">c</span>(<span class="st">"MB"</span>, <span class="st">"BC"</span>))</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😸</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_subregions works"</span>, {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  subregions <span class="ot">&lt;-</span> <span class="fu">get_subregions</span>()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(subregions), <span class="dv">806</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(subregions<span class="sc">$</span>province), <span class="dv">6</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  subregions_3 <span class="ot">&lt;-</span> <span class="fu">get_subregions</span>(<span class="fu">c</span>(<span class="st">"ON322"</span>, <span class="st">"SK010"</span>, <span class="st">"MB029"</span>, <span class="st">"test"</span>))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(<span class="fu">unique</span>(subregions_3<span class="sc">$</span>province), <span class="fu">c</span>(<span class="st">"ON"</span>, <span class="st">"SK"</span>, <span class="st">"MB"</span>))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 😸</code></pre>
</div>
</div>
</section>
<section id="provinces" class="level2">
<h2 class="anchored" data-anchor-id="provinces">Provinces</h2>
<p>The last function I added to the package is <code>get_provinces</code>, which has some population/geographical data, as well as a <a href="https://tdunn.ca/posts/2021-12-28-canada-covid-19-data-in-r-exploring-the-api/#provinces"><code>data_status</code> variable indicating if a province’s daily numbers have been updated</a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Get provinces and territories</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param geo_only Logical, indicating if only provinces/territories should be</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'   returned. If FALSE, also returned non-geographic entities like</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#'   Repatriated Canadians and the Federal Allocation for vaccinations.</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return A data frame with a row per province/territory.</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_provinces()</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' get_provinces(geo_only = FALSE)</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom dplyr bind_rows mutate</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' @importFrom rlang .data</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>get_provinces <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">geo_only =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.covid19tracker.ca/provinces"</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (geo_only) {</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    api_params <span class="ot">&lt;-</span> <span class="st">"?geo_only=true"</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>    api_params <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, api_params)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>  content_parsed <span class="ot">&lt;-</span> <span class="fu">get_content_parsed</span>(url)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(content_parsed) <span class="sc">%&gt;%</span></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Use logical type instead of 0/1</span></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">geographic =</span> .data<span class="sc">$</span>geographic <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">updated_at =</span> <span class="fu">as.POSIXct</span>(.data<span class="sc">$</span>updated_at)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/get-province-test_ddac8249eedb14cd4a89d266c7298c61">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_that</span>(<span class="st">"get_provinces"</span>, {</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  provinces <span class="ot">&lt;-</span> <span class="fu">get_provinces</span>()</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(provinces), <span class="dv">13</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(provinces), <span class="dv">10</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(provinces<span class="sc">$</span>code,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="st">"ON"</span>, <span class="st">"QC"</span>, <span class="st">"NS"</span>, <span class="st">"NB"</span>, <span class="st">"MB"</span>, <span class="st">"BC"</span>, <span class="st">"PE"</span>, <span class="st">"SK"</span>, <span class="st">"AB"</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"NL"</span>, <span class="st">"NT"</span>, <span class="st">"YT"</span>, <span class="st">"NU"</span>))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">request_sleep</span>()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  provinces_geo_false <span class="ot">&lt;-</span> <span class="fu">get_provinces</span>(<span class="at">geo_only =</span> <span class="cn">FALSE</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">nrow</span>(provinces_geo_false), <span class="dv">16</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_equal</span>(<span class="fu">ncol</span>(provinces_geo_false), <span class="dv">10</span>)</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expect_setequal</span>(provinces_geo_false<span class="sc">$</span>code,</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">c</span>(<span class="st">"ON"</span>, <span class="st">"QC"</span>, <span class="st">"NS"</span>, <span class="st">"NB"</span>, <span class="st">"MB"</span>, <span class="st">"BC"</span>, <span class="st">"PE"</span>, <span class="st">"SK"</span>, <span class="st">"AB"</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"NL"</span>, <span class="st">"NT"</span>, <span class="st">"YT"</span>, <span class="st">"NU"</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"_RC"</span>, <span class="st">"FA"</span>, <span class="st">"NFR"</span>))</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test passed 🥇</code></pre>
</div>
</div>
</section>
<section id="an-example-use-case" class="level2">
<h2 class="anchored" data-anchor-id="an-example-use-case">An example use case</h2>
<p>Now with the package up-and-running on GitHub, I’ll install it with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"taylordunn/canadacovid"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get cases per day across Canada, and compute a 7-day rolling average:</p>
<div class="cell" data-hash="canada-covid-19-data-in-r-creating-a-package_cache/html/reports-overall_71a8e4c55638269d2c27f43004473b88">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>reports_overall <span class="ot">&lt;-</span> canadacovid<span class="sc">::</span><span class="fu">get_reports</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    date, change_cases,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">change_cases_rolling_avg =</span> zoo<span class="sc">::</span><span class="fu">rollapply</span>(change_cases, <span class="dv">7</span>, mean,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">align =</span> <span class="st">"right"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>Make a plot of the cases:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>canada_red <span class="ot">&lt;-</span> <span class="st">"#FF0000"</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>canada_red_desat <span class="ot">&lt;-</span> <span class="st">"#bf3f3f"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>p_title <span class="ot">&lt;-</span> glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COVID-19 cases reported per day in Canada (with "</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;span style='color:{canada_red}'&gt;7-day rolling average&lt;/span&gt;)"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>reports_overall <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> change_cases)) <span class="sc">+</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y =</span> change_cases), <span class="at">fill =</span> canada_red, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">width =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> change_cases_rolling_avg),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> canada_red, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Cases"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">title =</span> p_title) <span class="sc">+</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="canada-covid-19-data-in-r-creating-a-package_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="hex-sticker" class="level2">
<h2 class="anchored" data-anchor-id="hex-sticker">Hex sticker</h2>
<p>To represent the package, I’ll quickly put together a hex sticker based on the above plot. I’m no artist, so I’ll use the <code>hexSticker</code> package to make it.</p>
<p>First iteration of the plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use data from before the omicron peak, which (sadly) extends the y axis a lot</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> reports_overall <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&lt;</span> <span class="st">"2021-12-01"</span>, <span class="sc">!</span><span class="fu">is.na</span>(change_cases_rolling_avg))</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> change_cases_rolling_avg)) <span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> change_cases_rolling_avg),</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> canada_red, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> canada_red, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>  dunnr<span class="sc">::</span><span class="fu">remove_axis</span>(<span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="canada-covid-19-data-in-r-creating-a-package_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For some extra visual interest, I’ll mark the peaks in the plot. My lazy approach for finding those days is to first roughly group the data into waves:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>waves <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2020-03-01"</span>, <span class="st">"2020-07-01"</span>, <span class="st">"2021-03-01"</span>,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"2021-07-15"</span>, <span class="st">"2021-11-01"</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> waves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="canada-covid-19-data-in-r-creating-a-package_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then find the maximum case count in each wave:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>peaks <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">cut</span>(date, <span class="at">breaks =</span> waves, <span class="at">labels =</span> <span class="fu">paste0</span>(<span class="st">"wave "</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(wave)) <span class="sc">%&gt;%</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(wave) <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(change_cases_rolling_avg <span class="sc">==</span> <span class="fu">max</span>(change_cases_rolling_avg)) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(wave, date, change_cases, change_cases_rolling_avg)</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>peaks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  wave   date       change_cases change_cases_rolling_avg
  &lt;fct&gt;  &lt;date&gt;            &lt;int&gt;                    &lt;dbl&gt;
1 wave 1 2020-05-03         2794                    1795.
2 wave 2 2021-01-10         8324                    8260.
3 wave 3 2021-04-17         8866                    8730.
4 wave 4 2021-09-17         5061                    4445.</code></pre>
</div>
</div>
<p>Now add these as white horizontal lines on the plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> peaks<span class="sc">$</span>date, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Re-draw the line so that it appears over the white lines</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> canada_red, <span class="at">size =</span> <span class="fl">1.5</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="canada-covid-19-data-in-r-creating-a-package_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Remove un-needed elements from the plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">0</span>, <span class="at">r =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">l =</span> <span class="dv">0</span>),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="dv">1</span>),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="canada-covid-19-data-in-r-creating-a-package_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, put it into a <code>hexSticker</code> and save the image:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the figure separately so I can control the size</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"hex-plot.png"</span>, <span class="at">plot =</span> p, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">500</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hexSticker)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>sysfonts<span class="sc">::</span><span class="fu">font_add_google</span>(<span class="st">"Inter"</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>showtext<span class="sc">::</span><span class="fu">showtext_auto</span>()</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>canada_red_a0<span class="fl">.5</span> <span class="ot">&lt;-</span> grDevices<span class="sc">::</span><span class="fu">adjustcolor</span>(canada_red, <span class="at">alpha.f =</span> <span class="fl">0.5</span>)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>hexSticker<span class="sc">::</span><span class="fu">sticker</span>(</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">subplot =</span> <span class="st">"hex-plot.png"</span>, <span class="at">s_width =</span> <span class="fl">0.7</span>, <span class="at">s_x =</span> <span class="fl">1.0</span>, <span class="at">s_y =</span> <span class="fl">0.8</span>,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">package =</span> <span class="st">"canadacovid"</span>,</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">p_family =</span> <span class="st">"Inter"</span>, <span class="at">p_size =</span> <span class="dv">30</span>, <span class="at">p_color =</span> canada_red,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">h_fill =</span> <span class="st">"white"</span>, <span class="at">h_color =</span> canada_red_a0<span class="fl">.5</span>,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"canadacovid-sticker.png"</span>, <span class="at">dpi =</span> <span class="dv">500</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/canadacovid-sticker.png" class="img-fluid figure-img" style="width:40.0%"></p>
</figure>
</div>
<p>Not bad. Not great.</p>
</section>



<div id="quarto-appendix" class="default"><section id="reproducibility" class="level2 appendix unlisted"><h2 class="quarto-appendix-heading">Reproducibility</h2><div class="quarto-appendix-contents">

<details>
<summary>
Session info
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> setting  value
 version  R version 4.2.1 (2022-06-23 ucrt)
 os       Windows 10 x64 (build 19044)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_Canada.utf8
 ctype    English_Canada.utf8
 tz       America/Curacao
 date     2022-08-22
 pandoc   2.18 @ C:/Program Files/RStudio/bin/quarto/bin/tools/ (via rmarkdown)</code></pre>
</div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["package"],"name":[1],"type":["chr"],"align":["left"]},{"label":["ondiskversion"],"name":[2],"type":["chr"],"align":["left"]},{"label":["loadedversion"],"name":[3],"type":["chr"],"align":["left"]},{"label":["path"],"name":[4],"type":["chr"],"align":["left"]},{"label":["loadedpath"],"name":[5],"type":["chr"],"align":["left"]},{"label":["attached"],"name":[6],"type":["lgl"],"align":["right"]},{"label":["is_base"],"name":[7],"type":["lgl"],"align":["right"]},{"label":["date"],"name":[8],"type":["chr"],"align":["left"]},{"label":["source"],"name":[9],"type":["chr"],"align":["left"]},{"label":["md5ok"],"name":[10],"type":["lgl"],"align":["right"]},{"label":["library"],"name":[11],"type":["fct"],"align":["left"]}],"data":[{"1":"assertthat","2":"0.2.1","3":"0.2.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/assertthat","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/assertthat","6":"FALSE","7":"FALSE","8":"2019-03-21","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"assertthat"},{"1":"backports","2":"1.4.1","3":"1.4.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/backports","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/backports","6":"FALSE","7":"FALSE","8":"2021-12-13","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"backports"},{"1":"brio","2":"1.1.3","3":"1.1.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/brio","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/brio","6":"FALSE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"brio"},{"1":"broom","2":"1.0.0","3":"1.0.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/broom","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/broom","6":"FALSE","7":"FALSE","8":"2022-07-01","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"broom"},{"1":"cachem","2":"1.0.6","3":"1.0.6","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/cachem","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/cachem","6":"FALSE","7":"FALSE","8":"2021-08-19","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"cachem"},{"1":"callr","2":"3.7.1","3":"3.7.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/callr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/callr","6":"FALSE","7":"FALSE","8":"2022-07-13","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"callr"},{"1":"cellranger","2":"1.1.0","3":"1.1.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/cellranger","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/cellranger","6":"FALSE","7":"FALSE","8":"2016-07-27","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"cellranger"},{"1":"cli","2":"3.3.0","3":"3.3.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/cli","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/cli","6":"FALSE","7":"FALSE","8":"2022-04-25","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"cli"},{"1":"colorspace","2":"2.0.3","3":"2.0-3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/colorspace","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/colorspace","6":"FALSE","7":"FALSE","8":"2022-02-21","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"colorspace"},{"1":"crayon","2":"1.5.1","3":"1.5.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/crayon","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/crayon","6":"FALSE","7":"FALSE","8":"2022-03-26","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"crayon"},{"1":"DBI","2":"1.1.3","3":"1.1.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/DBI","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/DBI","6":"FALSE","7":"FALSE","8":"2022-06-18","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"DBI"},{"1":"dbplyr","2":"2.2.1","3":"2.2.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/dbplyr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/dbplyr","6":"FALSE","7":"FALSE","8":"2022-06-27","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"dbplyr"},{"1":"devtools","2":"2.4.4","3":"2.4.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/devtools","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/devtools","6":"FALSE","7":"FALSE","8":"2022-07-20","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"devtools"},{"1":"digest","2":"0.6.29","3":"0.6.29","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/digest","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/digest","6":"FALSE","7":"FALSE","8":"2021-12-01","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"digest"},{"1":"distill","2":"1.4","3":"1.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/distill","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/distill","6":"FALSE","7":"FALSE","8":"2022-05-12","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"distill"},{"1":"downlit","2":"0.4.2","3":"0.4.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/downlit","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/downlit","6":"FALSE","7":"FALSE","8":"2022-07-05","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"downlit"},{"1":"dplyr","2":"1.0.9","3":"1.0.9","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/dplyr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/dplyr","6":"TRUE","7":"FALSE","8":"2022-04-28","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"dplyr"},{"1":"dunnr","2":"0.2.6","3":"0.2.6","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/dunnr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/dunnr","6":"TRUE","7":"FALSE","8":"2022-08-07","9":"Github (taylordunn/dunnr@e2a82136012b9edae43fc5f8e728492125366267)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"dunnr"},{"1":"ellipsis","2":"0.3.2","3":"0.3.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ellipsis","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ellipsis","6":"FALSE","7":"FALSE","8":"2021-04-29","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"ellipsis"},{"1":"evaluate","2":"0.15","3":"0.15","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/evaluate","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/evaluate","6":"FALSE","7":"FALSE","8":"2022-02-18","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"evaluate"},{"1":"extrafont","2":"0.18","3":"0.18","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/extrafont","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/extrafont","6":"FALSE","7":"FALSE","8":"2022-04-12","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"extrafont"},{"1":"extrafontdb","2":"1.0","3":"1.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/extrafontdb","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/extrafontdb","6":"FALSE","7":"FALSE","8":"2012-06-11","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"extrafontdb"},{"1":"fansi","2":"1.0.3","3":"1.0.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/fansi","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/fansi","6":"FALSE","7":"FALSE","8":"2022-03-24","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"fansi"},{"1":"farver","2":"2.1.1","3":"2.1.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/farver","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/farver","6":"FALSE","7":"FALSE","8":"2022-07-06","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"farver"},{"1":"fastmap","2":"1.1.0","3":"1.1.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/fastmap","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/fastmap","6":"FALSE","7":"FALSE","8":"2021-01-25","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"fastmap"},{"1":"forcats","2":"0.5.1","3":"0.5.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/forcats","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/forcats","6":"TRUE","7":"FALSE","8":"2021-01-27","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"forcats"},{"1":"fs","2":"1.5.2","3":"1.5.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/fs","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/fs","6":"FALSE","7":"FALSE","8":"2021-12-08","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"fs"},{"1":"gargle","2":"1.2.0","3":"1.2.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/gargle","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/gargle","6":"FALSE","7":"FALSE","8":"2021-07-02","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"gargle"},{"1":"generics","2":"0.1.3","3":"0.1.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/generics","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/generics","6":"FALSE","7":"FALSE","8":"2022-07-05","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"generics"},{"1":"ggplot2","2":"3.3.6","3":"3.3.6","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ggplot2","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ggplot2","6":"TRUE","7":"FALSE","8":"2022-05-03","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"ggplot2"},{"1":"ggrepel","2":"0.9.1","3":"0.9.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ggrepel","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ggrepel","6":"FALSE","7":"FALSE","8":"2021-01-15","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"ggrepel"},{"1":"ggtext","2":"0.1.1","3":"0.1.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ggtext","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ggtext","6":"TRUE","7":"FALSE","8":"2020-12-17","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"ggtext"},{"1":"glue","2":"1.6.2","3":"1.6.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/glue","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/glue","6":"FALSE","7":"FALSE","8":"2022-02-24","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"glue"},{"1":"googledrive","2":"2.0.0","3":"2.0.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/googledrive","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/googledrive","6":"FALSE","7":"FALSE","8":"2021-07-08","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"googledrive"},{"1":"googlesheets4","2":"1.0.0","3":"1.0.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/googlesheets4","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/googlesheets4","6":"FALSE","7":"FALSE","8":"2021-07-21","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"googlesheets4"},{"1":"gridtext","2":"0.1.4","3":"0.1.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/gridtext","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/gridtext","6":"FALSE","7":"FALSE","8":"2020-12-10","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"gridtext"},{"1":"gtable","2":"0.3.0","3":"0.3.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/gtable","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/gtable","6":"FALSE","7":"FALSE","8":"2019-03-25","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"gtable"},{"1":"haven","2":"2.5.0","3":"2.5.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/haven","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/haven","6":"FALSE","7":"FALSE","8":"2022-04-15","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"haven"},{"1":"hms","2":"1.1.1","3":"1.1.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/hms","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/hms","6":"FALSE","7":"FALSE","8":"2021-09-26","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"hms"},{"1":"htmltools","2":"0.5.2","3":"0.5.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/htmltools","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/htmltools","6":"FALSE","7":"FALSE","8":"2021-08-25","9":"CRAN (R 4.2.1)","10":"NA","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"htmltools"},{"1":"htmlwidgets","2":"1.5.4","3":"1.5.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/htmlwidgets","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/htmlwidgets","6":"FALSE","7":"FALSE","8":"2021-09-08","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"htmlwidgets"},{"1":"httpuv","2":"1.6.5","3":"1.6.5","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/httpuv","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/httpuv","6":"FALSE","7":"FALSE","8":"2022-01-05","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"httpuv"},{"1":"httr","2":"1.4.3","3":"1.4.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/httr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/httr","6":"FALSE","7":"FALSE","8":"2022-05-04","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"httr"},{"1":"jsonlite","2":"1.8.0","3":"1.8.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/jsonlite","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/jsonlite","6":"FALSE","7":"FALSE","8":"2022-02-22","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"jsonlite"},{"1":"knitr","2":"1.39","3":"1.39","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/knitr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/knitr","6":"FALSE","7":"FALSE","8":"2022-04-26","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"knitr"},{"1":"labeling","2":"0.4.2","3":"0.4.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/labeling","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/labeling","6":"FALSE","7":"FALSE","8":"2020-10-20","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"labeling"},{"1":"later","2":"1.3.0","3":"1.3.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/later","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/later","6":"FALSE","7":"FALSE","8":"2021-08-18","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"later"},{"1":"lifecycle","2":"1.0.1","3":"1.0.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/lifecycle","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/lifecycle","6":"FALSE","7":"FALSE","8":"2021-09-24","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"lifecycle"},{"1":"lubridate","2":"1.8.0","3":"1.8.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/lubridate","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/lubridate","6":"FALSE","7":"FALSE","8":"2021-10-07","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"lubridate"},{"1":"magrittr","2":"2.0.3","3":"2.0.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/magrittr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/magrittr","6":"FALSE","7":"FALSE","8":"2022-03-30","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"magrittr"},{"1":"markdown","2":"1.1","3":"1.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/markdown","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/markdown","6":"FALSE","7":"FALSE","8":"2019-08-07","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"markdown"},{"1":"memoise","2":"2.0.1","3":"2.0.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/memoise","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/memoise","6":"FALSE","7":"FALSE","8":"2021-11-26","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"memoise"},{"1":"mime","2":"0.12","3":"0.12","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/mime","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/mime","6":"FALSE","7":"FALSE","8":"2021-09-28","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"mime"},{"1":"miniUI","2":"0.1.1.1","3":"0.1.1.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/miniUI","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/miniUI","6":"FALSE","7":"FALSE","8":"2018-05-18","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"miniUI"},{"1":"modelr","2":"0.1.8","3":"0.1.8","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/modelr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/modelr","6":"FALSE","7":"FALSE","8":"2020-05-19","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"modelr"},{"1":"munsell","2":"0.5.0","3":"0.5.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/munsell","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/munsell","6":"FALSE","7":"FALSE","8":"2018-06-12","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"munsell"},{"1":"pillar","2":"1.8.0","3":"1.8.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pillar","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pillar","6":"FALSE","7":"FALSE","8":"2022-07-18","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"pillar"},{"1":"pkgbuild","2":"1.3.1","3":"1.3.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pkgbuild","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pkgbuild","6":"FALSE","7":"FALSE","8":"2021-12-20","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"pkgbuild"},{"1":"pkgconfig","2":"2.0.3","3":"2.0.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pkgconfig","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pkgconfig","6":"FALSE","7":"FALSE","8":"2019-09-22","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"pkgconfig"},{"1":"pkgload","2":"1.3.0","3":"1.3.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pkgload","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/pkgload","6":"FALSE","7":"FALSE","8":"2022-06-27","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"pkgload"},{"1":"prettyunits","2":"1.1.1","3":"1.1.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/prettyunits","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/prettyunits","6":"FALSE","7":"FALSE","8":"2020-01-24","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"prettyunits"},{"1":"processx","2":"3.7.0","3":"3.7.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/processx","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/processx","6":"FALSE","7":"FALSE","8":"2022-07-07","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"processx"},{"1":"profvis","2":"0.3.7","3":"0.3.7","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/profvis","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/profvis","6":"FALSE","7":"FALSE","8":"2020-11-02","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"profvis"},{"1":"promises","2":"1.2.0.1","3":"1.2.0.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/promises","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/promises","6":"FALSE","7":"FALSE","8":"2021-02-11","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"promises"},{"1":"ps","2":"1.7.1","3":"1.7.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ps","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ps","6":"FALSE","7":"FALSE","8":"2022-06-18","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"ps"},{"1":"purrr","2":"0.3.4","3":"0.3.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/purrr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/purrr","6":"TRUE","7":"FALSE","8":"2020-04-17","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"purrr"},{"1":"R6","2":"2.5.1","3":"2.5.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/R6","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/R6","6":"FALSE","7":"FALSE","8":"2021-08-19","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"R6"},{"1":"ragg","2":"1.2.2","3":"1.2.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ragg","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/ragg","6":"FALSE","7":"FALSE","8":"2022-02-21","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"ragg"},{"1":"Rcpp","2":"1.0.9","3":"1.0.9","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/Rcpp","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/Rcpp","6":"FALSE","7":"FALSE","8":"2022-07-08","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"Rcpp"},{"1":"readr","2":"2.1.2","3":"2.1.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/readr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/readr","6":"TRUE","7":"FALSE","8":"2022-01-30","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"readr"},{"1":"readxl","2":"1.4.0","3":"1.4.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/readxl","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/readxl","6":"FALSE","7":"FALSE","8":"2022-03-28","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"readxl"},{"1":"remotes","2":"2.4.2","3":"2.4.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/remotes","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/remotes","6":"FALSE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"remotes"},{"1":"renv","2":"0.15.5","3":"0.15.5","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/renv","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/renv","6":"FALSE","7":"FALSE","8":"2022-05-26","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"renv"},{"1":"reprex","2":"2.0.1","3":"2.0.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/reprex","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/reprex","6":"FALSE","7":"FALSE","8":"2021-08-05","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"reprex"},{"1":"rlang","2":"1.0.4","3":"1.0.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rlang","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rlang","6":"FALSE","7":"FALSE","8":"2022-07-12","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"rlang"},{"1":"rmarkdown","2":"2.14","3":"2.14","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rmarkdown","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rmarkdown","6":"FALSE","7":"FALSE","8":"2022-04-25","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"rmarkdown"},{"1":"rstudioapi","2":"0.13","3":"0.13","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rstudioapi","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rstudioapi","6":"FALSE","7":"FALSE","8":"2020-11-12","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"rstudioapi"},{"1":"Rttf2pt1","2":"1.3.8","3":"1.3.8","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/Rttf2pt1","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/Rttf2pt1","6":"FALSE","7":"FALSE","8":"2020-01-10","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"Rttf2pt1"},{"1":"rvest","2":"1.0.2","3":"1.0.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rvest","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/rvest","6":"FALSE","7":"FALSE","8":"2021-10-16","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"rvest"},{"1":"scales","2":"1.2.0","3":"1.2.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/scales","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/scales","6":"FALSE","7":"FALSE","8":"2022-04-13","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"scales"},{"1":"sessioninfo","2":"1.2.2","3":"1.2.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/sessioninfo","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/sessioninfo","6":"FALSE","7":"FALSE","8":"2021-12-06","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"sessioninfo"},{"1":"shiny","2":"1.7.2","3":"1.7.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/shiny","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/shiny","6":"FALSE","7":"FALSE","8":"2022-07-19","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"shiny"},{"1":"stringi","2":"1.7.8","3":"1.7.8","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/stringi","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/stringi","6":"FALSE","7":"FALSE","8":"2022-07-11","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"stringi"},{"1":"stringr","2":"1.4.0","3":"1.4.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/stringr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/stringr","6":"TRUE","7":"FALSE","8":"2019-02-10","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"stringr"},{"1":"systemfonts","2":"1.0.4","3":"1.0.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/systemfonts","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/systemfonts","6":"FALSE","7":"FALSE","8":"2022-02-11","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"systemfonts"},{"1":"testthat","2":"3.1.4","3":"3.1.4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/testthat","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/testthat","6":"TRUE","7":"FALSE","8":"2022-04-26","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"testthat"},{"1":"textshaping","2":"0.3.6","3":"0.3.6","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/textshaping","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/textshaping","6":"FALSE","7":"FALSE","8":"2021-10-13","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"textshaping"},{"1":"tibble","2":"3.1.8","3":"3.1.8","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tibble","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tibble","6":"TRUE","7":"FALSE","8":"2022-07-22","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"tibble"},{"1":"tidyr","2":"1.2.0","3":"1.2.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tidyr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tidyr","6":"TRUE","7":"FALSE","8":"2022-02-01","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"tidyr"},{"1":"tidyselect","2":"1.1.2","3":"1.1.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tidyselect","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tidyselect","6":"FALSE","7":"FALSE","8":"2022-02-21","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"tidyselect"},{"1":"tidyverse","2":"1.3.2","3":"1.3.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tidyverse","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tidyverse","6":"TRUE","7":"FALSE","8":"2022-07-18","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"tidyverse"},{"1":"tzdb","2":"0.3.0","3":"0.3.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tzdb","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/tzdb","6":"FALSE","7":"FALSE","8":"2022-03-28","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"tzdb"},{"1":"urlchecker","2":"1.0.1","3":"1.0.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/urlchecker","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/urlchecker","6":"FALSE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"urlchecker"},{"1":"usethis","2":"2.1.6","3":"2.1.6","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/usethis","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/usethis","6":"FALSE","7":"FALSE","8":"2022-05-25","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"usethis"},{"1":"utf8","2":"1.2.2","3":"1.2.2","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/utf8","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/utf8","6":"FALSE","7":"FALSE","8":"2021-07-24","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"utf8"},{"1":"vctrs","2":"0.4.1","3":"0.4.1","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/vctrs","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/vctrs","6":"FALSE","7":"FALSE","8":"2022-04-13","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"vctrs"},{"1":"withr","2":"2.5.0","3":"2.5.0","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/withr","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/withr","6":"FALSE","7":"FALSE","8":"2022-03-03","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"withr"},{"1":"xfun","2":"0.31","3":"0.31","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/xfun","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/xfun","6":"FALSE","7":"FALSE","8":"2022-05-10","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"xfun"},{"1":"xml2","2":"1.3.3","3":"1.3.3","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/xml2","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/xml2","6":"FALSE","7":"FALSE","8":"2021-11-30","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"xml2"},{"1":"xtable","2":"1.8.4","3":"1.8-4","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/xtable","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/xtable","6":"FALSE","7":"FALSE","8":"2019-04-21","9":"CRAN (R 4.2.1)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"xtable"},{"1":"yaml","2":"2.3.5","3":"2.3.5","4":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/yaml","5":"C:/Users/tdunn/AppData/Local/R/win-library/4.2/yaml","6":"FALSE","7":"FALSE","8":"2022-02-21","9":"CRAN (R 4.2.0)","10":"TRUE","11":"C:/Users/tdunn/AppData/Local/R/win-library/4.2","_rn_":"yaml"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</details>
<details>
<summary>
Git repository
</summary>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Local:    main C:/Users/tdunn/Documents/tdunn-quarto
Remote:   main @ origin (https://github.com/taylordunn/tdunn-quarto.git)
Head:     [0b35ed3] 2022-08-22: Added `tidytuesday-2022-week-12` post</code></pre>
</div>
</div>
</details>
<p><a href="https://github.com/taylordunn/tdunn-quarto/tree/main/posts/2021-12-30-canada-covid-19-data-in-r-creating-a-package">Source code</a>, <a href="https://github.com/taylordunn/tdunn-quarto/tree/main/posts/2021-12-30-canada-covid-19-data-in-r-creating-a-package/renv.lock">R environment</a></p>


</div></section><section class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1" role="doc-endnote"><p>Using GitHub Actions is new to me, and probably overkill for a small hobby project like this, but I was inspired by <a href="https://www.rstudio.com/resources/rstudioconf-2020/azure-pipelines-and-github-actions/">Jim Hester’s RStudio::Conf 2020 talk</a> to give it a try.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{dunn2021,
  author = {Taylor Dunn},
  title = {Canada {COVID-19} Data in {R:} Creating a Package},
  date = {2021-12-30},
  url = {https://tdunn.ca/posts/2021-12-30-canada-covid-19-data-in-r-creating-a-package/canada-covid-19-data-in-r-creating-a-package.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-dunn2021" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Taylor Dunn. 2021. <span>“Canada COVID-19 Data in R: Creating a
Package.”</span> December 30, 2021. <a href="https://tdunn.ca/posts/2021-12-30-canada-covid-19-data-in-r-creating-a-package/canada-covid-19-data-in-r-creating-a-package.html">https://tdunn.ca/posts/2021-12-30-canada-covid-19-data-in-r-creating-a-package/canada-covid-19-data-in-r-creating-a-package.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    toggleBodyColorMode(window.document.querySelector("link#quarto-bootstrap"));
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>